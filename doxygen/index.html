<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libasynql: libasynql v3.0.0 &lt;img src=&quot;https://poggit.pmmp.io/ci.badge/poggit/libasynql/libasynql&quot; align=&quot;right&quot;/&gt;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libasynql
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
   <div id="projectbrief">Asynchronous MySQL access library for PocketMine plugins.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">libasynql v3.0.0 </p><div class="image">
<img src="https://poggit.pmmp.io/ci.badge/poggit/libasynql/libasynql" align="right"/>
</div>
 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Asynchronous SQL access library for PocketMine plugins.</p>
<h2>Usage</h2>
<p>The basic use of libasynql has 5 steps:</p><ol type="1">
<li>Add default database settings in your <code>config.yml</code>.</li>
<li>Write down all the SQL queries you will use in a resource file</li>
<li>Initialize the database in <code>onEnable()</code>.</li>
<li>Finalize the database in <code>onDisable()</code>.</li>
<li>Obviously, and most importantly, use libasynql in your code.</li>
</ol>
<h3>Configuration</h3>
<p>To let the user choose what database to use, copy the following into your default <code>config.yml</code>. Remember to change the default schema name under <code>mysql</code>.</p>
<div class="fragment"><div class="line">database:</div><div class="line">  # The database type. &quot;sqlite&quot; and &quot;mysql&quot; are supported.</div><div class="line">  type: sqlite</div><div class="line"></div><div class="line">  # Edit these settings only if you choose &quot;sqlite&quot;.</div><div class="line">  sqlite:</div><div class="line">    # The file name of the database in the plugin data folder.</div><div class="line">    # You can also put an absolute path here.</div><div class="line">    file: data.sqlite</div><div class="line">  # Edit these settings only if you choose &quot;mysql&quot;.</div><div class="line">  mysql:</div><div class="line">    host: 127.0.0.1</div><div class="line">    # Avoid using the &quot;root&quot; user for security reasons.</div><div class="line">    username: root</div><div class="line">    password: &quot;&quot;</div><div class="line">    schema: your_schema</div><div class="line">  # The maximum number of simultaneous SQL queries</div><div class="line">  # Recommended: 1 for sqlite, 2 for MySQL. You may want to further increase this value if your MySQL connection is very slow.</div><div class="line">  worker-limit: 1</div></div><!-- fragment --><h3>Initialization and Finalization</h3>
<p>libasynql simplifies the process of initializing a database into a single function call.</p>
<div class="fragment"><div class="line">use pocketmine\plugin\PluginBase;</div><div class="line">use <a class="code" href="namespacepoggit_1_1libasynql_1_1libasynql.html">poggit\libasynql\libasynql</a>;</div><div class="line"></div><div class="line"><span class="keyword">class </span>Main <span class="keyword">extends</span> PluginBase{</div><div class="line">    <span class="keyword">private</span> $database;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> onEnable(){</div><div class="line">        $this-&gt;saveDefaultConfig();</div><div class="line">        $this-&gt;database = libasynql::create($this, $this-&gt;getConfig()-&gt;<span class="keyword">get</span>(<span class="stringliteral">&quot;database&quot;</span>), [</div><div class="line">            <span class="stringliteral">&quot;sqlite&quot;</span> =&gt; <span class="stringliteral">&quot;sqlite.sql&quot;</span>,</div><div class="line">            <span class="stringliteral">&quot;mysql&quot;</span> =&gt; <span class="stringliteral">&quot;mysql.sql&quot;</span></div><div class="line">        ]);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> onDisable(){</div><div class="line">        <span class="keywordflow">if</span>(isset($this-&gt;database)) $this-&gt;database-&gt;close();</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>The <a href="https://poggit.github.io/libasynql/doxygen/classpoggit_1_1libasynql_1_1libasynql.html#add1449f8fef87cc275a3d99f2440c642"><code>\poggit\libasynql\libasynql::create()</code></a> method accepts 3 parameters:</p><ul>
<li>Your plugin main</li>
<li>The config entry where the database settings should be found</li>
<li>An array for your SQL files. For each SQL dialect you are supporting, use it as the key, and use the path (or array of paths, relative to the <code>resources</code> folder) of the SQL files as the value. We are going to create them in the next step.</li>
</ul>
<p>It returns a <a href="https://poggit.github.io/libasynql/doxygen/interfacepoggit_1_1libasynql_1_1_data_connector.html"><code>\poggit\libasynql\DataConnector</code></a> object, which is the main query interface.</p>
<p>In case of error, a ConfigException or an SqlError will be thrown. If not caught by the plugin, this will go straight out of onEnable() and disable the plugin. Therefore, make sure to check <code>isset($this-&gt;database)</code> before calling <code>$this-&gt;database-&gt;close()</code> in onDisable().</p>
<h3>Creating SQL files</h3>
<p>In the resources file, create one file for each SQL dialect you are supporting, e.g. <code>resources/sqlite.sql</code> and <code>resources/mysql.sql</code>.</p>
<p>Write down all the queries you are going to use in each file, using the <a href="#prepared-statement-file-format">Prepared Statement File format</a>.</p>
<h3>Calling libasynql functions</h3>
<p>Finally, we are prepared to use libasynql in code!</p>
<p>There are 4 query modes you can ues: GENERIC, CHANGE, INSERT and SELECT.</p><ul>
<li>GENERIC: You don't want to know anything about the query except whether it is successful. You may want to use this in <code>CREATE TABLE</code> statements.</li>
<li>CHANGE: Your query modifies the database, and you want to know how many rows are changed. Useful in <code>UPDATE</code>/<code>DELETE</code> statements.</li>
<li>INSERT: Your query is an <code>INSERT INTO</code> query for a table with an <code>AUTO_INCREMENT</code> key. You will receive the auto-incremented row ID.</li>
<li>SELECT: Your query expects a result set, e.g. a <code>SELECT</code> statement, or reflection queries like <code>EXPLAIN</code> and <code>SHOW TABLES</code>. You will receive a <code>SqlSelectResult</code> object that represents the columns and rows returned.</li>
</ul>
<p>They have their respective methods in DataConnector: <code>executeGeneric</code>, <code>executeChange</code>, <code>executeInsert</code>, <code>executeSelect</code>. They require the same parameters:</p>
<ul>
<li>The name of the prepared statement</li>
<li>The variables for the query, in the form of an associative array "variable name (without colon)" =&gt; value</li>
<li>An optional callable triggered if the query succeeded, accepting different arguments:<ul>
<li>GENERIC: no arguments</li>
<li>CHANGE: <code>function(int $affectedRows)</code></li>
<li>INSERT: <code>function(int $insertId, int $affectedRows)</code></li>
<li>SELECT: <code>function(array $rows)</code></li>
</ul>
</li>
<li>An optional callable triggered if an error occurred. Can accept an <code>SqlError</code> object.</li>
</ul>
<h2>Prepared Statement File Format</h2>
<p>A Prepared Statement File (PSF) contains the queries that a plugin uses. The content is valid SQL, so it is OK to edit with a normal SQL editor.</p>
<p>The PSF is annotated by "command lines", which start with <code>-- #</code>, followed by the command symbol, then the arguments. Between the <code>#</code> and the command symbol, there can be zero to infinite spaces or tabs; between the command symbol and the arguments, there can also be zero to infinite spaces or tabs. Between every two arguments, one to infinite spaces or tabs are required.</p>
<h3>Dialect declaration</h3>
<p>A PSF always starts with a dialect declaration.</p>
<h4>Symbol</h4>
<p><code>!</code></p>
<h4>Arguments</h4>
<h5>DIALECT</h5>
<p>Possible values: <code>mysql</code>, <code>sqlite</code></p>
<h4>Example</h4>
<div class="fragment"><div class="line"><span class="comment">-- #! mysql</span></div></div><!-- fragment --><h3>Group declaration</h3>
<p>Queries may be organized by groups. Each group has an identifier name, and a group can be stacked under another. Groups and queries under a group will be prepended the parent group's identifier plus a period in their own identifiers.</p>
<p>For example, if a parent group declares an identifier <code>foo</code>, and the child group/query declares an identifier <code>bar</code>, the real identifier for the child group/query is <code>foo.bar</code>.</p>
<p>Duplicate group identifier declarations are allowed, as long as the resultant queries do not have identical full identifiers.</p>
<h4>Symbol</h4>
<ul>
<li>Start: <code>{</code></li>
<li>End: <code>}</code></li>
</ul>
<h4>Arguments (Start)</h4>
<h5>IDENTIFIER_NAME</h5>
<p>The name of this group.</p>
<p>All characters except spaces and tabs are allowed, including periods.</p>
<h4>Example</h4>
<div class="fragment"><div class="line"><span class="comment">-- #{ group.name.here</span></div><div class="line">    <span class="comment">-- #{ child.name</span></div><div class="line">        <span class="comment">-- the identifier of the child group is &quot;group.name.here.child.name&quot;</span></div><div class="line">    <span class="comment">-- #}</span></div><div class="line"><span class="comment">-- #}</span></div></div><!-- fragment --><p>Note that PSF is insensitive about spaces and tabs, so this variant is equivalent:</p>
<div class="fragment"><div class="line"><span class="comment">-- #{ group.name.here</span></div><div class="line"><span class="comment">-- #    { child.name</span></div><div class="line">        <span class="comment">-- the identifier of the child group is still &quot;group.name.here.child.name&quot;</span></div><div class="line"><span class="comment">-- #    }</span></div><div class="line"><span class="comment">-- #}</span></div></div><!-- fragment --><h3>Query declaration</h3>
<p>A query is declared like a group. A query does not need to belong to a group, because the query can declare the periods in its own identifier, which has equivalent effect as groups.</p>
<p>Child groups are not allowed in a query declaration. In other words, a <code>{}</code> pair either has other group/query declarations inside, or has query text (and optionally variable declarations) inside. It cannot have both.</p>
<h4>Symbol</h4>
<ul>
<li>Start: <code>{</code> (same as group declaration)</li>
<li>End: <code>}</code></li>
</ul>
<h4>Arguments</h4>
<p>Same arguments as a group declaration.</p>
<h3>Variable declaration</h3>
<p>A variable declaration declares the required and optional variables for this query. It is only allowed inside a query declaration.</p>
<h4>Symbol</h4>
<ul>
<li><code>:</code></li>
</ul>
<h4>Arguments</h4>
<h5>VAR_NAME</h5>
<p>The name of the variable. Any characters apart from spaces, tabs and colons are allowed. However, to comply with ordinary SQL editors, using "normal" symbols (e.g. variable names in other programming languages) is recommended.</p>
<h5>VAR_TYPE</h5>
<p>The variable type. Possible values:</p><ul>
<li><code>string</code></li>
<li><code>int</code></li>
<li><code>float</code></li>
<li><code>bool</code></li>
</ul>
<h5>VAR_DEFAULT</h5>
<p>If the variable is optional, it declares a default value.</p>
<p>This argument is not affected by spaces. It starts from the first non-space non-tab character after VAR_TYPE, and ends before the trailing space/tab characters of the line</p>
<h6><code>string</code> default</h6>
<p>There are two modes, literal string and JSON string.</p>
<p>If the argument starts with a <code>"&lt;/tt&gt; and ends with a &lt;tt&gt;"</code>, the whole argument will be parsed in JSON. Otherwise, the whole string is taken literally.</p>
<h6><code>int</code> default</h6>
<p>A numeric value that can be parsed by <a href="https://php.net/intval"><code>(int)</code> cast, equivalent to <code>intval</code></a>.</p>
<h6><code>float</code> default</h6>
<p>A numeric value that can be parsed by <a href="https://php.net/floatval"><code>(float)</code> cast, equivalent to <code>floatval</code></a>.</p>
<h6><code>bool</code> default</h6>
<p><code>true</code>, <code>on</code>, <code>yes</code> or <code>1</code> will result in true. Other values, as long as there is something, will result default false. (If there is nothing, the variable will not be optional)</p>
<h3>Query text</h3>
<p>Query text is not a command, but the non-commented part between the start and end commands of a query declaration.</p>
<p>Variables are interpolated in query text using the <code>:var</code> format. Note that libasynql uses a homebrew algorithm for identifying the variable positions, so they might be inaccurate.</p>
<h3>Overall example</h3>
<p>See <a href="LibasynqlExample/resources/mysql.sql">mysql.sql</a> and <a href="LibasynqlExample/resources/sqlite3.sql">sqlite3.sql</a> in the example plugin. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
